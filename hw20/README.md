# demon

## Задание
Написать демон получения размера заданного через конфигурацию файла. Демон должен отдавать
текущий размер файла по запросу через сокет домена UNIX, заданный в конфигурации, и сразу разрывать
соединение с клиентом.

## Задачи:
1. Создать консольное приложение, способное запускаться как в фоне, так и без демонизации.
2. Реализовать чтение конфигурации из файла
3. Приложение должно прослушивать сокет.
4. По наличию текста в сокете приложение должно возвращать в него размер файла, заданного в конфигурации.

## Требования к коду:
* корректное определение размера файла, до и после изменения, в т.ч. после удаления;
* успешная компиляция с флагами `-Wall -Wextra -Wpedantic -std=c11`.

## Вспомогательные материалы
1. [ncat(1)](https://man7.org/linux/man-pages/man1/ncat.1.html)

# Реализация

Требования: компилятор Си11, стандартная библиотека (проверялось в Linux, GCC 13.2.0, libc 2.38),
библиотека libconfuse, поддержка UNIX domain sockets.

Сборка: `make` или `gcc -o demon demon.c \`pkg-config --cflags libconfuse --libs libconfuse\` -Wall -Wextra -Wpedantic -std=c11.`

Использование: 
* `demon` - обычный запуск;
* `demon -d` - запуск в режиме "демона";

Список опций: `demon -h`.

## Описание работы
Программа считывает опции командной строки. Может быть задан режим работы ("демон" или обычный), имя файла конфигурации,
сокета и файла, размер которого будет возвращаться. Затем происходит чтение и анализ файла конфигурации,
установка параметров. Аргументы командной строки имеют преимущество перед конфигом. Если ни в одном из мест
параметр не задан, то берётся значение по умолчанию.

После инициализации программа открывает на прослушивание UNIX сокет. При поступлении в него любого текста в ответ
 (а также в лог) возвращается размер файла, после чего соединение закрывается и программа ждёт нового.

Для завершения работы необходимо послать SIGINT или SIGTERM.

Лог пишется в `stderr` в обычном режиме и в `syslog` в фоновом ("демон").

## Что можно улучшить
1. Доделать перечитывание файла конфигурации по SIGHUP (сейчас только считываются параметры, но сокет с новым именем не пересоздаётся).
2. Реализовать смену каталога для демона (сейчас отключена, чтобы не ругалась на отсутствие прав при создании файла сокета).
3. Добавить защиту от повторного запуска (.pid-файл).
